<div class="col-12 col-sm-6 col-md-4 col-lg-3 p-3">
  <% if ranking == "1st" %>
    <div class="scoreboard-player-card" id="card-1st">
  <% elsif ranking == "2nd" %>
    <div class="scoreboard-player-card" id="card-2nd">
  <% elsif ranking == "3rd" %>
    <div class="scoreboard-player-card" id="card-3rd">
  <% else %>
    <div class="scoreboard-player-card card-reg">
  <% end %>
    <div class="first-row">

      <div class="ranking">
        <h4><%= ranking %></h4>
      </div>

      <div>
        <p class="scoreboard-p">Rating:</p>
        <h4><%= player.rating %></h4>
      </div>
    </div>

    <div class="text-center mb-1">
      <% if player.photo.attached? %>
        <%= cl_image_tag player.photo.key, class: "player-avatar",
          transformation: [
            {gravity: "face", height: 128, width: 128, crop: "crop"},
            {radius: "max"},
            {width: 128, crop: "scale"}
          ] %>
      <% else %>
        <%= image_tag "user-astronaut-solid.svg", class: "player-avatar" %>
      <% end %>
    </div>

    <div class="player-name">
      <p><strong><%= player.name %></strong></p>
    </div>

    <div class="player-bottom-half-info">
      <div class="score-line">
      <%# Tried a cleaner logic but it didn't work, may want to refactor later %>
        <p>
          <%= player.win_count == player.win_count.to_i ? player.win_count.round : player.win_count %>
          -
          <%= player.loss_count == player.loss_count.to_i ? player.loss_count.round : player.loss_count %>
        </p>
        <div>&nbsp;</div>
        <p class="spread">(<% if player.spread.positive? %>
            +<%= player.spread %>
          <% else %>
            <%= player.spread %>
          <% end %>
        )</p>
      </div>

      <div class="next-last">
        <p class="d-flex gap-2">
          <% player_round = (player.win_count + player.loss_count).round.to_i %>

          <%# Player's last game score %>
          <% @tournament.matchups.each do |matchup| %>
            <% if matchup[:round_number] == player_round%>
              <% if matchup.player1 == player %>
                <strong>Last:</strong>
                <%= matchup[:player1_score] %>
                -
              <% elsif matchup.player2 == player %>
                <strong>Last:</strong>
                <%= matchup[:player2_score] %>
                -
              <% end %>
            <% end %>
          <% end %>

          <% @tournament.matchups.each do |matchup| %>
            <% if matchup[:round_number] == player_round %>
              <% if matchup.player1 == player %>
                <%= matchup[:player2_score] %>
              <% elsif matchup.player2 == player %>
                <%= matchup[:player1_score] %>
              <% end %>
            <% end %>
          <% end %>

          <%# Last game opponent's name%>
          <% @tournament.matchups.each do |matchup| %>
            <% if matchup[:round_number] == player_round %>
              <% if matchup.player1 == player %>
                <% opponent = matchup.player2.id %>
              vs. <%= Player.find(opponent).name %>
              <% elsif matchup.player2 == player %>
                <% opponent = matchup.player1.id %>
              vs. <%= Player.find(opponent).name %>
              <% end %>
            <% end %>
          <% end %>
        </p>
      </div>

      <%# Player's next game opponent%>
      <div class="next-last">
        <p class="d-flex gap-2">
          <strong>Next:</strong>
          <% @tournament.matchups.each do |matchup| %>
            <% if matchup[:round_number] == player_round + 1 %>
              <% if matchup.player1 == player %>
                <% if matchup.player2.name != "Bye" %>
                  <%= "1st vs." %>
                <% end %>
                <% opponent_id = matchup.player2.id %>
                <%= Player.find(opponent_id).name %>
              <% elsif matchup.player2 == player %>
                <% if matchup.player1.name != "Bye" %>
                  <%= "2nd vs."  %>
                <% end %>
                <% opponent_id = matchup.player1.id %>
                <%= Player.find(opponent_id).name %>
              <% end %>
            <% end %>
          <% end %>
        </p>
      </div>
    </div>



  </div>
</div>
